---
id: amazon-security-lake
name: Amazon Security Lake
author: Tenzir
author_icon: https://raw.githubusercontent.com/tenzir/library/main/.tenzir.svg
package_icon: https://raw.githubusercontent.com/tenzir/library/main/amazon-security-lake/package.svg
description: |
  [Amazon Security Lake](https://aws.amazon.com/security-lake/) automatically
  centralizes security data from cloud, on-premises, and custom sources.

  This package provides pipelines for writing OCSF events to Amazon Security
  Lake using the S3-based ingestion format.

  *NOTE*: Before you can write events to the Security Lake, you must configure
  a *custom source* per event type in Security Lake and ensure the Tenzir Node
  has write permissions to the S3 bucket in the respective source directory. The
  package assumes that you adhere to the Tenzir naming scheme `tnz-ocsf-XXXX` where
  `XXXX` is the class UID of an OCSF event class.
categories:
  - destinations

inputs:
  input-topic:
    name: Input topic
    description: Topic to subscribe to for OCSF events
    default: ocsf
  bucket-name:
    name: S3 bucket name
    description: The name of the S3 bucket in Security Lake (e.g., `aws-security-data-lake-eu-west-2-lake-abcdefghijklmnopqrstuvwxyz1234`
  region:
    name: AWS Region
    description: AWS region where the Security Lake is deployed
  account-id:
    name: AWS Account ID
    description: The ID of the AWS account that hosts the Security Lake instance.
  external-id:
    name: AWS External ID
    description: The external ID for all custom sources.
  timeout:
    name: Timeout
    description: Timeout for writing to Security Lake
    default: 5m

pipelines:
  tnz-ocsf-1001:
    name: OCSF File System Activity → Amazon Security Lake
    description: Sends OCSF File System Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1001"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.file_system_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-1002:
    name: OCSF Kernel Extension Activity → Amazon Security Lake
    description: Sends OCSF Kernel Extension Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1002"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.kernel_extension_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-1003:
    name: OCSF Kernel Activity → Amazon Security Lake
    description: Sends OCSF Kernel Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1003"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.kernel_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-1004:
    name: OCSF Memory Activity → Amazon Security Lake
    description: Sends OCSF Memory Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1004"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.memory_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-1005:
    name: OCSF Module Activity → Amazon Security Lake
    description: Sends OCSF Module Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1005"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.module_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-1006:
    name: OCSF Scheduled Job Activity → Amazon Security Lake
    description: Sends OCSF Scheduled Job Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1006"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.scheduled_job_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-1007:
    name: OCSF Process Activity → Amazon Security Lake
    description: Sends OCSF Process Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1007"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.process_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-1008:
    name: OCSF Event Log Activity → Amazon Security Lake
    description: Sends OCSF Event Log Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1008"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.event_log_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-1009:
    name: OCSF Script Activity → Amazon Security Lake
    description: Sends OCSF Script Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-1009"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.script_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-2001:
    name: OCSF Security Finding → Amazon Security Lake
    description: Sends OCSF Security Finding events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-2001"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.security_finding"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-2002:
    name: OCSF Vulnerability Finding → Amazon Security Lake
    description: Sends OCSF Vulnerability Finding events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-2002"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.vulnerability_finding"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-2003:
    name: OCSF Compliance Finding → Amazon Security Lake
    description: Sends OCSF Compliance Finding events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-2003"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.compliance_finding"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-2004:
    name: OCSF Detection Finding → Amazon Security Lake
    description: Sends OCSF Detection Finding events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-2004"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.detection_finding"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-2005:
    name: OCSF Incident Finding → Amazon Security Lake
    description: Sends OCSF Incident Finding events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-2005"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.incident_finding"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-2006:
    name: OCSF Data Security Finding → Amazon Security Lake
    description: Sends OCSF Data Security Finding events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-2006"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.data_security_finding"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-2007:
    name: OCSF Application Security Posture Finding → Amazon Security Lake
    description: Sends OCSF Application Security Posture Finding events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-2007"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.application_security_posture_finding"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-3001:
    name: OCSF Account Change → Amazon Security Lake
    description: Sends OCSF Account Change events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-3001"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.account_change"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-3002:
    name: OCSF Authentication → Amazon Security Lake
    description: Sends OCSF Authentication events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-3002"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.authentication"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-3003:
    name: OCSF Authorize Session → Amazon Security Lake
    description: Sends OCSF Authorize Session events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-3003"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.authorize_session"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-3004:
    name: OCSF Entity Management → Amazon Security Lake
    description: Sends OCSF Entity Management events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-3004"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.entity_management"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-3005:
    name: OCSF User Access Management → Amazon Security Lake
    description: Sends OCSF User Access Management events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-3005"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.user_access_management"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-3006:
    name: OCSF Group Management → Amazon Security Lake
    description: Sends OCSF Group Management events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-3006"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.group_management"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4001:
    name: OCSF Network Activity → Amazon Security Lake
    description: Sends OCSF Network Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4001"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.network_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4002:
    name: OCSF HTTP Activity → Amazon Security Lake
    description: Sends OCSF HTTP Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4002"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.http_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4003:
    name: OCSF DNS Activity → Amazon Security Lake
    description: Sends OCSF DNS Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4003"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.dns_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4004:
    name: OCSF DHCP Activity → Amazon Security Lake
    description: Sends OCSF DHCP Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4004"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.dhcp_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4005:
    name: OCSF RDP Activity → Amazon Security Lake
    description: Sends OCSF RDP Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4005"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.rdp_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4006:
    name: OCSF SMB Activity → Amazon Security Lake
    description: Sends OCSF SMB Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4006"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.smb_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4007:
    name: OCSF SSH Activity → Amazon Security Lake
    description: Sends OCSF SSH Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4007"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.ssh_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4008:
    name: OCSF FTP Activity → Amazon Security Lake
    description: Sends OCSF FTP Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4008"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.ftp_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4009:
    name: OCSF Email Activity → Amazon Security Lake
    description: Sends OCSF Email Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4009"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.email_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4013:
    name: OCSF NTP Activity → Amazon Security Lake
    description: Sends OCSF NTP Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4013"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.ntp_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-4014:
    name: OCSF Tunnel Activity → Amazon Security Lake
    description: Sends OCSF Tunnel Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-4014"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.tunnel_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-5001:
    name: OCSF Device Inventory Info → Amazon Security Lake
    description: Sends OCSF Device Inventory Info events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-5001"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.device_inventory_info"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-5002:
    name: OCSF Device Config State → Amazon Security Lake
    description: Sends OCSF Device Config State events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-5002"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.device_config_state"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-5003:
    name: OCSF User Inventory → Amazon Security Lake
    description: Sends OCSF User Inventory events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-5003"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.user_inventory"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-5004:
    name: OCSF Operating System Patch State → Amazon Security Lake
    description: Sends OCSF Operating System Patch State events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-5004"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.operating_system_patch_state"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-6001:
    name: OCSF Web Resources Activity → Amazon Security Lake
    description: Sends OCSF Web Resources Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-6001"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.web_resources_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-6002:
    name: OCSF Application Lifecycle → Amazon Security Lake
    description: Sends OCSF Application Lifecycle events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-6002"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.application_lifecycle"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-6003:
    name: OCSF API Activity → Amazon Security Lake
    description: Sends OCSF API Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-6003"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.api_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-6005:
    name: OCSF Datastore Activity → Amazon Security Lake
    description: Sends OCSF Datastore Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-6005"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.datastore_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-6006:
    name: OCSF File Hosting Activity → Amazon Security Lake
    description: Sends OCSF File Hosting Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-6006"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.file_hosting_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-6007:
    name: OCSF Scan Activity → Amazon Security Lake
    description: Sends OCSF Scan Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-6007"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.scan_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-6008:
    name: OCSF Application Error → Amazon Security Lake
    description: Sends OCSF Application Error events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-6008"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.application_error"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-7001:
    name: OCSF Remediation Activity → Amazon Security Lake
    description: Sends OCSF Remediation Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-7001"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.remediation_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-7002:
    name: OCSF File Remediation Activity → Amazon Security Lake
    description: Sends OCSF File Remediation Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-7002"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.file_remediation_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-7003:
    name: OCSF Process Remediation Activity → Amazon Security Lake
    description: Sends OCSF Process Remediation Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-7003"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.process_remediation_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-201001:
    name: OCSF Registry Key Activity → Amazon Security Lake
    description: Sends OCSF Registry Key Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-201001"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.registry_key_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-201002:
    name: OCSF Registry Value Activity → Amazon Security Lake
    description: Sends OCSF Registry Value Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-201002"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.registry_value_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-201003:
    name: OCSF Windows Resource Activity → Amazon Security Lake
    description: Sends OCSF Windows Resource Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-201003"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.windows_resource_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

  tnz-ocsf-201004:
    name: OCSF Windows Service Activity → Amazon Security Lake
    description: Sends OCSF Windows Service Activity events to Amazon Security Lake
    disabled: true
    definition: |
      let $custom_source = "tnz-ocsf-201004"
      let $account_id = "{{ inputs.account-id }}"
      let $region = "{{ inputs.region }}"
      let $bucket = "{{ inputs.bucket-name }}"
      let $role = f"arn:aws:iam::{$account_id}:role/AmazonSecurityLake-Provider-{$custom_source}-{$region}"
      subscribe "{{ inputs.input-topic }}"
      where @name == "ocsf.windows_service_activity"
      ocsf::apply
      to_amazon_security_lake f"s3://{$bucket}/ext/{$custom_source}",
        account_id=$account_id,
        region=$region,
        role=$role,
        external_id="{{ inputs.external-id }}",
        timeout={{ inputs.timeout }}

examples:
  - name: Send OCSF Network Activity events with cross-account role
    description: |
      Send OCSF Network Activity events to Security Lake using cross-account
      role assumption with `role` and `external_id` parameters.
    definition: |
      let $lake_source_url = "s3://your-security-lake-bucket/ext/tnz-ocsf-4001"
      let $lake_region = "us-east-1"
      let $lake_account_id = "123456789012"
      let $role_arn = "arn:aws:iam::123456789012:role/SecurityLakeRole"
      let $external_id = "unique-external-id-123"

      subscribe "ocsf"
      where @name == "ocsf.network_activity"
      ocsf::apply
      to_amazon_security_lake $lake_source_url,
        region=$lake_region,
        account_id=$lake_account_id,
        role=$role_arn,
        external_id=$external_id
