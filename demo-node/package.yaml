id: demo-node
name: Demo Node
author: Tenzir
author_icon: https://github.com/tenzir.png
package_icon: https://raw.githubusercontent.com/tenzir/library/main/demo-node/package.svg

description: |
  This package provides sample data and example pipelines to play with. Every
  cloud-hosted demo node has this package installed by default.

  The package imports a Zeek and Suricata logs that run on a PCAP from a
  modified version of the M57-Patents dataset, a forensics research corpus
  generated by Woods at al. in 2001. We enhanced this PCAP by also injecting
  traffic from malware samples.

pipelines:
  m57-suricata:
    name: M57 Suricata
    description: |
      Load Suricata Eve JSON logs from a GCS bucket and import them into the
      demo node.
    definition: |
      // tql2
      load_http "https://storage.googleapis.com/tenzir-datasets/M57/suricata.json.zst"
      decompress "zstd"
      read_suricata no_extra_fields=true
      where @name != "suricata.stats"
      import

  m57-zeek:
    name: M57 Zeek
    description: |
      Load Zeek TSV logs from a GCS bucket and import them into the demo node.
    definition: |
      // tql2
      load_http "https://storage.googleapis.com/tenzir-datasets/M57/zeek-all.log.zst"
      decompress "zstd"
      read_zeek_tsv
      import

snippets:
  - name: Show all Suricata alerts
    description: |
      Use the `where` operator to zero in on one particular schema.
    definition: |
      // tql2
      export
      where @name == "suricata.alert"

  - name: View a sample of Zeek TSV logs
    description: |
      The `taste` operator returns up to the specified number of events per
      schema. We use it to show some of all Zeek TSV logs to get an idea of our
      dataset.
    definition: |
      // tql2
      export
      where "zeek" in @name
      taste 10

  - name: Identify long-running connections
    description: |
      Use the `where` operator with a more complex expression to identify
      long-running connections in a specific CIDR subnet.
    definition: |
      export
      | where #schema == "zeek.conn"
      | where :ip in 10.10.5.0/25
      | where orig_bytes > 1 Mi or duration > 30 min

  - name: Identify top hitters
    description: |
      Use the `top` operator to see the top 5 hitters in Zeek notice logs.
    definition: |
      export
      | where #schema == "zeek.notice"
      | top msg
      | head 5
