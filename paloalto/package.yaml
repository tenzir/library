id: paloalto
name: Palo Alto Networks
author: Tenzir
author_icon: https://raw.githubusercontent.com/tenzir/library/main/author.svg
package_icon: https://raw.githubusercontent.com/tenzir/library/main/paloalto/package.svg

description: |
  [Palo Alto Networks](https://www.paloaltonetworks.com) solutions analyze and control network traffic by identifying applications and users,
  facilitating effective policy enforcement and threat prevention.

  This package simplifies the process of integrating and managing logs generated by Palo Alto Networks devices.
categories:
- sources

inputs:
  url:
    name: URL
    description: A URL where Palo Alto logs are provided.
    type: string
    default: udp://0.0.0.0:514
  traffic:
    name: Traffic log fields
    description: A comma-separated list of fields for Traffic logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,src_ip,dest_ip,src_nat_ip,dest_nat_ip,rule,src_user,dest_user,app_name,virtual_system,src_zone,dest_zone,interface_inbound,interface_outbound,log_action,future_use2,session_id,repeat_count,src_port,dest_port,src_nat_port,dest_nat_port,flags,protocol_name,status,bytes,bytes_out,bytes_in,packets,start_time,processed_time,panw_panos_url_category,future_use3,panw_panos_sequence_number,action_flags,src_location,dest_location,future_use4,packets_out,packets_in,session_end_reason,device_group_hierarchy_level1,device_group_hierarchy_level2,device_group_hierarchy_level3,device_group_hierarchy_level4,virtual_system_name,device_name,status_src,src_vm_uuid,dest_vm_uuid,tunnel_id_imsi,monitor_tag_imei,parent_session_id,parent_start_time,tunnel_type,sctp_association_id,sctp_chunks,sctp_chunks_sent,sctp_chunks_received,rule_uuid,http2_connection,app_flap_count,policy_id,link_switches,sd_wan_cluster,sd_wan_device_type,sd_wan_cluster_type,sd_wan_site,dynamic_user_group_name,xff_address,src_device_category,src_device_profile,src_device_model,src_device_vendor,src_device_os_family,src_device_os_version,src_hostname,src_mac,dest_device_category,dest_device_profile,dest_device_model,dest_device_vendor,dest_device_os_family,dest_device_os_version,dest_hostname,dest_mac,container_id,pod_namespace,pod_name,src_external_dynamic_list,dest_external_dynamic_list,host_id,serialnumber,src_dynamic_address_group,dest_dynamic_address_group,session_owner,high_resolution_timestamp,slice_service_type,slice_differentiator,app_subcategory,app_category,app_technology,app_risk,app_characteristic,app_container,tunneled_app,app_sass,app_sanctioned_state,offloaded,future_use5
  globalprotect:
    name: GlobalProtect log fields
    description: A comma-separated list of fields for GlobalProtect logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,vsys,event_id,stage,auth_method,tunnel_type,src_user,src_region,machine_name,public_ip,public_ipv6,private_ip,private_ipv6,host_id,serialnumber,client_ver,client_os,client_os_ver,repeat_count,reason,error,opaque,status,location,login_duration,connect_method,error_code,portal,sequence_number,action_flags,event_time,selection_type,response_time,priority,attempted_gateways,gateway,devicegroup_level1,devicegroup_level2,devicegroup_level3,devicegroup_level4,vsys_name,dvc_name,vsys_id
  threat:
    name: Threat log fields
    description: A comma-separated list of fields for Threat logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,src_ip,dest_ip,src_translated_ip,dest_translated_ip,rule,src_user,dest_user,app,vsys,src_zone,dest_zone,src_interface,dest_interface,log_forwarding_profile,future_use2,session_id,repeat_count,src_port,dest_port,src_translated_port,dest_translated_port,session_flags,ip_protocol,action,misc,threat,raw_category,severity,direction,sequence_number,action_flags,src_location,dest_location,future_use3,content_type,pcap_id,file_hash,cloud_address,url_index,user_agent,file_type,xff,referrer,sender,subject,recipient,report_id,devicegroup_level1,devicegroup_level2,devicegroup_level3,devicegroup_level4,vsys_name,dvc_name,future_use4,src_vm,dest_vm,http_method,tunnel_id,tunnel_monitor_tag,tunnel_session_id,tunnel_start_time,tunnel_type,threat_category,content_version,future_use5,sctp_assoc_id,payload_protocol_id,http_headers,url_category_list,rule_uuid,http2_connection,dynusergroup_name,xff_ip,src_dvc_category,src_dvc_profile,src_dvc_model,src_dvc_vendor,src_dvc_os_family,src_dvc_os_version,src_dvc_host,src_dvc_mac,dest_dvc_category,dest_dvc_profile,dest_dvc_model,dest_dvc_vendor,dest_dvc_os_family,dest_dvc_os_version,dest_dvc_host,dest_dvc_mac,container_id,pod_namespace,pod_name,src_edl,dest_edl,host_id,dvc_serial_number,domain_edl,src_dag,dest_dag,partial_hash,high_res_timestamp,reason,justification,nssai_sst,app_subcategory,app_category,app_technology,app_risk,app_characteristic,app_container,app_tunneled,app_saas,app_sanction,cloud_report_id
  url-filtering:
    name: URL-Filtering log fields
    description: A comma-separated list of fields for URL-Filtering logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,src_address,dest_address,nat_src_ip,nat_dest_ip,rule_name,src_user,dest_user,app,virtual_system,src_zone,dest_zone,inbound_interface,outbound_interface,log_action,future_use2,session_id,repeat_count,src_port,dest_port,nat_src_port,nat_dest_port,flags,ip_protocol,action,url/filename,threat_id,category,severity,direction,sequence_number,action_flags,src_country,dest_country,future_use3,content_type,pcap_id,file_digest,cloud,url_index,user_agent,file_type,x-forwarded-for,referer,sender,subject,recipient,report_id,dvc_group_hierarchy_level1,dvc_group_hierarchy_level2,dvc_group_hierarchy_level3,dvc_group_hierarchy_level4,virtual_system_name,dvc_name,future_use4,src_vm_uuid,dest_vm_uuid,http_method,tunnel_id/imsi,monitor_tag/imei,parent_session_id,parent_start_time,tunnel_type,threat_category,content_version,future_use5,sctp_association_id,payload_protocol_id,http_headers,url_category_list,rule_uuid,http/2_connection,dynamic_user_group_name,xff_address,src_dvc_category,src_dvc_profile,src_dvc_model,src_dvc_vendor,src_dvc_os_family,src_dvc_os_version,src_hostname,src_mac_address,dest_dvc_category,dest_dvc_profile,dest_dvc_model,dest_dvc_vendor,dest_dvc_os_family,dest_dvc_os_version,dest_hostname,dest_mac_address,container_id,pod_namespace,pod_name,src_external_dynamic_list,dest_external_dynamic_list,host_id,serial_number2,domain_edl,src_dynamic_address_group,dest_dynamic_address_group,partial_hash,high_resolution_timestamp,reason,justification,a_slice_service_type,app_subcategory,app_category,app_technology,app_risk,app_characteristic,app_container,tunneled_app,app_saas,app_sanctioned_state
  data-filtering:
    name: Data-Filtering log fields
    description: A comma-separated list of fields for Data-Filtering logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,src_address,dest_address,nat_src_ip,nat_dest_ip,rule_name,src_user,dest_user,app,virtual_system,src_zone,dest_zone,inbound_interface,outbound_interface,log_action,future_use2,session_id,repeat_count,src_port,dest_port,nat_src_port,nat_dest_port,flags,ip_protocol,action,url/filename,threat_id,category,severity,direction,sequence_number,action_flags,src_country,dest_country,future_use3,content_type,pcap_id,file_digest,cloud,url_index,user_agent,file_type,x-forwarded-for,referer,sender,subject,recipient,report_id,dvc_group_hierarchy_level1,dvc_group_hierarchy_level2,dvc_group_hierarchy_level3,dvc_group_hierarchy_level4,virtual_system_name,dvc_name,future_use4,src_vm_uuid,dest_vm_uuid,http_method,tunnel_id/imsi,monitor_tag/imei,parent_session_id,parent_start_time,tunnel_type,threat_category,content_version,future_use5,sctp_association_id,payload_protocol_id,http_headers,url_category_list,rule_uuid,http/2_connection,dynamic_user_group_name,xff_address,src_dvc_category,src_dvc_profile,src_dvc_model,src_dvc_vendor,src_dvc_os_family,src_dvc_os_version,src_hostname,src_mac_address,dest_dvc_category,dest_dvc_profile,dest_dvc_model,dest_dvc_vendor,dest_dvc_os_family,dest_dvc_os_version,dest_hostname,dest_mac_address,container_id,pod_namespace,pod_name,src_external_dynamic_list,dest_external_dynamic_list,host_id,serial_number2,domain_edl,src_dynamic_address_group,dest_dynamic_address_group,partial_hash,high_resolution_timestamp,reason,justification,a_slice_service_type,app_subcategory,app_category,app_technology,app_risk,app_characteristic,app_container,tunneled_app,app_saas,app_sanctioned_state
  correlation:
    name: Correlation log fields
    description: A comma-separated list of fields for Correlation logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,src_address,src_user,virtual_system,category,severity,device_group_hierarchy_level1,device_group_hierarchy_level2,device_group_hierarchy_level3,device_group_hierarchy_level4,virtual_system_name,device_name,virtual_system_id,object_name,object_id,evidence
  tunnel-inspection:
    name: Tunnel Inspection log fields
    description: A comma-separated list of fields for Tunnel Inspection logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,src_address,dest_address,nat_src_ip,nat_dest_ip,rule_name,src_user,dest_user,app,virtual_system,src_zone,dest_zone,inbound_interface,outbound_interface,log_action,future_use2,session_id,repeat_count,src_port,dest_port,nat_src_port,nat_dest_port,flags,protocol,action,severity,sequence_number,action_flags,src_location,dest_location,dvc_group_hierarchy_level_1,dvc_group_hierarchy_level_2,dvc_group_hierarchy_level_3,dvc_group_hierarchy_level_4,virtual_system_name,dvc_name,tunnel_id/imsi,monitor_tag/imei,parent_session_id,parent_start_time,tunnel,bytes,bytes_sent,bytes_received,packets,packets_sent,packets_received,maximum_encapsulation,unknown_protocol,strict_check,tunnel_fragment,sessions_created,sessions_closed,session_end_reason,action_src,start_time,elapsed_time,tunnel_inspection_rule,remote_user_ip,remote_user_id,rule_uuid,pcap_id,dynamic_user_group,src_external_dynamic_list,dest_external_dynamic_list,high_resolution_timestamp,a_slice_differentiator,a_slice_service_type,pdu_session_id,app_subcategory,app_category,app_technology,app_risk,app_characteristic,app_container,app_saas,app_sanctioned_state
  config:
    name: Config log fileds
    description: A comma-separated list of fields for Config logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,host_name,vsys,command,admin,client,result,configuration_path,sequence_number,action_flags,before_change_detail,after_change_detail,devicegroup_level1,devicegroup_level2,devicegroup_level3,devicegroup_level4,vsys_name,dvc_name,dvc_group,audit_comment
  system:
    name: System log fields
    description: A comma-separated list of fields for System logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,vsys,event_id,object,future_use2,future_use3,module,severity,description,sequence_number,action_flags,devicegroup_level1,devicegroup_level2,devicegroup_level3,devicegroup_level4,vsys_name,dvc_name,future_use5,future_use6,high_res_timestamp
  hip-match:
    name: HIP Match log fields
    description: A comma-separated list of fields for HIP Match logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,src_user,vsys,host_name,os,src_ip,hip_name,hip_count,hip_type,future_use2,future_use3,sequence_number,action_flags,devicegroup_level1,devicegroup_level2,devicegroup_level3,devicegroup_level4,vsys_name,dvc_name,vsys_id,ipv6_system_address,host_id,serialnumber,mac,high_res_timestamp
  ip-tags:
    name: IP-Tags log fields
    description: A comma-separated list of fields for IP-Tags logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generate_time,virtual_system,src_ip,tag_name,event_id,repeat_count,timeout,data_src_name,data_src_type,data_src_subtype,sequence_number,action_flags,dg_hierarchy_level1,dg_hierarchy_level2,dg_hierarchy_level3,dg_hierarchy_level4,virtual_system_name,dvc_name,virtual_system_id,high_resolution_timestamp
  user-id:
    name: User-ID log fields
    description: A comma-separated list of fields for User-ID logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,vsys,src_ip,user,datasource_name,event_id,repeat_count,timeout_threshold,src_port,dest_port,datasource,datasource_type,sequence_number,action_flags,devicegroup_level1,devicegroup_level2,devicegroup_level3,devicegroup_level4,vsys_name,dvc_name,vsys_id,factor_type,factor_completion_time,factor_number,ugflags,userbysource,high_res_timestamp
  decryption:
    name: Decryption log fields
    description: A comma-separated list of fields for Decryption logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,src_ip,dest_ip,src_translated_ip,dest_translated_ip,rule,src_user,dest_user,app,vsys,src_zone,dest_zone,src_interface,dest_interface,log_forwarding_profile,start_time,session_id,repeat_count,src_port,dest_port,src_translated_port,dest_translated_port,flags,ip_protocol,action,tunnel_id,future_use2,future_use3,src_vm_uuid,dest_vm_uuid,uuid_rule,stage_client_firewall,stage_firewall_client,tls_version,key_exchange_algorithm,encryption_algorithm,hash_algorithm,policy_name,elliptic_curve,error_index,root_status,chain_status,proxy_type,cert_serial_number,fingerprint,cert_start_time,cert_end_time,cert_version,cert_size,cn_length,issuer_cn_length,root_cn_length,sni_length,cert_flags,subject_cn,issuer_subject_cn,root_subject_cn,server_name,error,container_id,pod_namespace,pod_name,src_edl,dest_edl,src_dag,dest_dag,timestamp,src_dvc_category,src_dvc_profile,src_dvc_model,src_dvc_vendor,src_dvc_os,src_dvc_os_version,src_name,src_mac,dest_dvc_category,dest_dvc_profile,dest_dvc_model,dest_dvc_vendor,dest_dvc_os,dest_dvc_os_version,dest_name,dest_mac,sequence_number,action_flags,devicegroup_level1,devicegroup_level2,devicegroup_level3,devicegroup_level4,vsys_name,dvc_name,vsys_id,app_subcategory,app_category,app_technology,app_risk,app_characteristic,app_container,app_tunneled,app_saas,app_sanctioned
  authentication:
    name: Authentication log fields
    description: A comma-separated list of fields for Authentication logs.
    type: string
    default: future_use1,receive_time,serial_number,type,log_subtype,version,generated_time,virtual_system,src_ip,user,normalize_user,object,authentication_policy,repeat_count,authentication_id,vendor,log_action,server_profile,description,client_type,event_type,factor_number,sequence_number,action_flags,dvc_group_hierarchy1,dvc_group_hierarchy2,dvc_group_hierarchy3,dvc_group_hierarchy4,virtual_system_name,dvc_name,virtual_system_id,authentication_protocol,uuid_for_rule,high_resolution_timestamp,src_dvc_category,src_dvc_profile,src_dvc_model,src_dvc_vendor,src_dvc_os_family,src_dvc_os_version,src_hostname,src_mac_address,region,future_use3,user_agent,session_id

pipelines:
  onboard-from-url:
    name: Onboard and parse Palo Alto logs
    description: |
      Onboards and parses Palo Alto Networks logs from the provided URL and
      publishes them to the topic `paloalto`.

      The package removes all reserved fields (starting with `future_use`) from
      the event and removes the Syslog framing.

       The package supports the following log types:
       - Traffic
       - GlobalProtect
       - Data Filtering
       - Correlation
       - Tunnel Inspection
       - Config
       - System
       - HIP Match
       - IP-Tags
       - User-ID
       - Decryption
       - Authentication

       All other log types get forwarded including their raw Syslog framing as
       `paloalto.unknown` events.
    definition: |
      from "{{ inputs.url }}" {
        read_syslog
      }
      if ",TRAFFIC," in content {
        content = content.parse_csv(header="{{ inputs.traffic }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.traffic"
      } else if ",GLOBALPROTECT," in content {
        content = content.parse_csv(header="{{ inputs.globalprotect }}")
        content.message = content.message.parse_kv(field_split="\\s*,\\s*", value_split="\\s*:\\s*")
        this = content.drop_matching("^future_use")
        @name = "paloalto.globalprotect"
      } else if ",THREAT," in content {
        content = content.parse_csv(header="{{ inputs.threat }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.threat"
      } else if ",URL-FILTERING," in content {
        content = content.parse_csv(header="{{ inputs.url-filtering }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.url-filtering"
      } else if ",DATA-FILTERING," in content {
        content = content.parse_csv(header="{{ inputs.data-filtering }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.data-filtering"
      } else if ",CORRELATION," in content {
        content = content.parse_csv(header="{{ inputs.correlation }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.correlation"
      } else if ",TUNNEL-INSPECTION," in content {
        content = content.parse_csv(header="{{ inputs.tunnel-inspection }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.tunnel-inspection"
      } else if ",CONFIG," in content {
        content = content.parse_csv(header="{{ inputs.config }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.config"
      } else if ",SYSTEM," in content {
        content = content.parse_csv(header="{{ inputs.system }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.system"
      } else if ",HIP-MATCH," in content {
        content = content.parse_csv(header="{{ inputs.hip-match }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.hip-match"
      } else if ",IP-TAGS," in content {
        content = content.parse_csv(header="{{ inputs.ip-tags }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.ip-tags"
      } else if ",USER-ID," in content {
        content = content.parse_csv(header="{{ inputs.user-id }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.user-id"
      } else if ",DECRYPTION," in content {
        content = content.parse_csv(header="{{ inputs.decryption }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.decryption"
      } else if ",AUTHENTICATION," in content {
        content = content.parse_csv(header="{{ inputs.authentication }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.authentication"
      } else {
        @name = "paloalto.unknown"
      }
      publish "paloalto"
