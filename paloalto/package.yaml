id: paloalto
name: Palo Alto Networks
author: Tenzir
author_icon: https://raw.githubusercontent.com/tenzir/library/main/.tenzir.svg
package_icon: https://raw.githubusercontent.com/tenzir/library/main/paloalto/package.svg

description: |
  [Palo Alto Networks](https://www.paloaltonetworks.com) solutions analyze and control network traffic by identifying applications and users,
  facilitating effective policy enforcement and threat prevention.

  This package simplifies the process of integrating and managing logs generated by Palo Alto Networks devices. It is
  written for PAN OS version 10.
categories:
- sources

inputs:
  url:
    name: URL
    description: A URL where Palo Alto logs are provided.
    type: string
    default: udp://0.0.0.0:514
  traffic:
    name: Traffic log fields
    description: A comma-separated list of fields for Traffic logs.
    type: string
    default: future_use1,receive_time,serial_number,type,threat_content_type,future_use2,generated_time,source_address,destination_address,nat_source_ip,nat_destination_ip,rule_name,source_user,destination_user,application,virtual_system,source_zone,destination_zone,inbound_interface,outbound_interface,log_action,future_use3,session_id,repeat_count,source_port,destination_port,nat_source_port,nat_destination_port,flags,protocol,action,bytes,bytes_sent,bytes_received,packets,start_time,elapsed_time,category,future_use4,sequence_number,action_flags,source_country,destination_country,future_use5,packets_sent,packets_received,session_end_reason,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,action_source,source_vm_uuid,destination_vm_uuid,tunnel_id_imsi,monitor_tag_imei,parent_session_id,parent_start_time,tunnel_type,sctp_association_id,sctp_chunks,sctp_chunks_sent,sctp_chunks_received,rule_uuid,http_2_connection,app_flap_count,policy_id,link_switches,sd_wan_cluster,sd_wan_device_type,sd_wan_cluster_type,sd_wan_site,dynamic_user_group_name,xff_address,source_device_category,source_device_profile,source_device_model,source_device_vendor,source_device_os_family,source_device_os_version,source_hostname,source_mac_address,destination_device_category,destination_device_profile,destination_device_model,destination_device_vendor,destination_device_os_family,destination_device_os_version,destination_hostname,destination_mac_address,container_id,pod_namespace,pod_name,source_external_dynamic_list,destination_external_dynamic_list,host_id,serial_number,source_dynamic_address_group,destination_dynamic_address_group,session_owner,high_resolution_timestamp,a_slice_service_type,a_slice_differentiator,application_subcategory,application_category,application_technology,application_risk,application_characteristic,application_container,tunneled_application,application_saas,application_sanctioned_state,offloaded
  globalprotect:
    name: GlobalProtect log fields
    description: A comma-separated list of fields for GlobalProtect logs.
    type: string
    default: future_use1,receive_time,serial_number,type,threat_content_type,future_use2,generated_time,virtual_system,event_id,stage,authentication_method,tunnel_type,source_user,source_region,machine_name,public_ip,public_ipv6,private_ip,private_ipv6,host_id,serial_number,client_version,client_os,client_os_version,repeat_count,reason,error,description,status,location,login_duration,connect_method,error_code,portal,sequence_number,action_flags,high_res_timestamp,selection_type,response_time,priority,attempted_gateways,gateway,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,virtual_system_id
  threat:
    name: Threat log fields
    description: A comma-separated list of fields for Threat logs.
    type: string
    default: future_use1,receive_time,serial_number,type,threat_content_type,future_use2,generated_time,source_address,destination_address,nat_source_ip,nat_destination_ip,rule_name,source_user,destination_user,application,virtual_system,source_zone,destination_zone,inbound_interface,outbound_interface,log_action,future_use3,session_id,repeat_count,source_port,destination_port,nat_source_port,nat_destination_port,flags,ip_protocol,action,url_filename,threat_id,category,severity,direction,sequence_number,action_flags,source_country,destination_country,future_use4,content_type,pcap_id,file_digest,cloud,url_index,user_agent,file_type,x_forwarded_for,referer,sender,subject,recipient,report_id,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,future_use5,source_vm_uuid,destination_vm_uuid,http_method,tunnel_id_imsi,monitor_tag_imei,parent_session_id,parent_start_time,tunnel_type,threat_category,content_version,future_use6,sctp_association_id,payload_protocol_id,http_headers,url_category_list,rule_uuid,http_2_connection,dynamic_user_group_name,xff_address,source_device_category,source_device_profile,source_device_model,source_device_vendor,source_device_os_family,source_device_os_version,source_hostname,source_mac_address,destination_device_category,destination_device_profile,destination_device_model,destination_device_vendor,destination_device_os_family,destination_device_os_version,destination_hostname,destination_mac_address,container_id,pod_namespace,pod_name,source_external_dynamic_list,destination_external_dynamic_list,host_id,serial_number,domain_edl,source_dynamic_address_group,destination_dynamic_address_group,partial_hash,high_resolution_timestamp,reason,justification,a_slice_service_type,application_subcategory,application_category,application_technology,application_risk,application_characteristic,application_container,tunneled_application,application_saas,application_sanctioned_state
  url-filtering:
    name: URL-Filtering log fields
    description: A comma-separated list of fields for URL-Filtering logs.
    type: string
    default: future_use1,receive_time,serial_number,type,threat_content_type,future_use2,generated_time,source_address,destination_address,nat_source_ip,nat_destination_ip,rule_name,source_user,destination_user,application,virtual_system,source_zone,destination_zone,inbound_interface,outbound_interface,log_action,future_use3,session_id,repeat_count,source_port,destination_port,nat_source_port,nat_destination_port,flags,ip_protocol,action,url_filename,threat_id,category,severity,direction,sequence_number,action_flags,source_country,destination_country,future_use4,content_type,pcap_id,file_digest,cloud,url_index,user_agent,file_type,x_forwarded_for,referer,sender,subject,recipient,report_id,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,future_use5,source_vm_uuid,destination_vm_uuid,http_method,tunnel_id_imsi,monitor_tag_imei,parent_session_id,parent_start_time,tunnel_type,threat_category,content_version,future_use6,sctp_association_id,payload_protocol_id,http_headers,url_category_list,rule_uuid,http_2_connection,dynamic_user_group_name,xff_address,source_device_category,source_device_profile,source_device_model,source_device_vendor,source_device_os_family,source_device_os_version,source_hostname,source_mac_address,destination_device_category,destination_device_profile,destination_device_model,destination_device_vendor,destination_device_os_family,destination_device_os_version,destination_hostname,destination_mac_address,container_id,pod_namespace,pod_name,source_external_dynamic_list,destination_external_dynamic_list,host_id,serial_number,domain_edl,source_dynamic_address_group,destination_dynamic_address_group,partial_hash,high_resolution_timestamp,reason,justification,a_slice_service_type,application_subcategory,application_category,application_technology,application_risk,application_characteristic,application_container,tunneled_application,application_saas,application_sanctioned_state
  data-filtering:
    name: Data-Filtering log fields
    description: A comma-separated list of fields for Data-Filtering logs.
    type: string
    default: future_use1,receive_time,serial_number,type,threat_content_type,future_use2,generated_time,source_address,destination_address,nat_source_ip,nat_destination_ip,rule_name,source_user,destination_user,application,virtual_system,source_zone,destination_zone,inbound_interface,outbound_interface,log_action,future_use3,session_id,repeat_count,source_port,destination_port,nat_source_port,nat_destination_port,flags,ip_protocol,action,url_filename,threat_id,category,severity,direction,sequence_number,action_flags,source_country,destination_country,future_use4,content_type,pcap_id,file_digest,cloud,url_index,user_agent,file_type,x_forwarded_for,referer,sender,subject,recipient,report_id,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,future_use5,source_vm_uuid,destination_vm_uuid,http_method,tunnel_id_imsi,monitor_tag_imei,parent_session_id,parent_start_time,tunnel_type,threat_category,content_version,future_use6,sctp_association_id,payload_protocol_id,http_headers,url_category_list,rule_uuid,http_2_connection,dynamic_user_group_name,xff_address,source_device_category,source_device_profile,source_device_model,source_device_vendor,source_device_os_family,source_device_os_version,source_hostname,source_mac_address,destination_device_category,destination_device_profile,destination_device_model,destination_device_vendor,destination_device_os_family,destination_device_os_version,destination_hostname,destination_mac_address,container_id,pod_namespace,pod_name,source_external_dynamic_list,destination_external_dynamic_list,host_id,serial_number,domain_edl,source_dynamic_address_group,destination_dynamic_address_group,partial_hash,high_resolution_timestamp,reason,justification,a_slice_service_type,application_subcategory,application_category,application_technology,application_risk,application_characteristic,application_container,tunneled_application,application_saas,application_sanctioned_state
  correlation:
    name: Correlation log fields
    description: A comma-separated list of fields for Correlation logs.
    type: string
    default: future_use1,receive_time,serial_number,type,content_threat_type,future_use2,generated_time,source_address._source_user,virtual_system,category,severity,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,virtual_system_id,object_name,object_id,evidence
  tunnel-inspection:
    name: Tunnel Inspection log fields
    description: A comma-separated list of fields for Tunnel Inspection logs.
    type: string
    default: future_use1,receive_time,serial_number,type,subtype,future_use2,generated_time,source_address,destination_address,nat_source_ip,nat_destination_ip,rule_name,source_user,destination_user,application,virtual_system,source_zone,destination_zone,inbound_interface,outbound_interface,log_action,future_use3,session_id,repeat_count,source_port,destination_port,nat_source_port,nat_destination_port,flags,protocol,action,severity,sequence_number,action_flags,source_country,destination_country,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,tunnel_id_imsi,monitor_tag_imei,parent_session_id,parent_start_time,tunnel,bytes,bytes_sent,bytes_received,packets,packets_sent,packets_received,maximum_encapsulation,unknown_protocol,strict_check,tunnel_fragment,sessions_created,sessions_closed,session_end_reason,action_source,start_time,elapsed_time,tunnel_inspection_rule,remote_user_ip,remote_user_id,rule_uuid,pcap_id,dynamic_user_group,source_external_dynamic_list,destination_external_dynamic_list,high_resolution_timestamp,a_slice_differentiator,a_slice_service_type,pdu_session_id,application_subcategory,application_category,application_technology,application_risk,application_characteristic,application_container,application_saas,application_sanctioned_state
  config:
    name: Config log fields
    description: A comma-separated list of fields for Config logs.
    type: string
    default: future_use1,receive_time,serial_number,type,subtype,future_use2,generated_time,host,virtual_system,command,admin,client,result,configuration_path,before_change_detail,after_change_detail,sequence_number,action_flags,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,device_group,audit_comment,future_use3,high_resolution_timestamp
  system:
    name: System log fields
    description: A comma-separated list of fields for System logs.
    type: string
    default: future_use1,receive_time,serial_number,type,content_threat_type,future_use2,generated_time,virtual_system,event_id,object,future_use3,future_use4,module,severity,description,sequence_number,action_flags,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,future_use5,future_use6,high_resolution_timestamp
  hip-match:
    name: HIP Match log fields
    description: A comma-separated list of fields for HIP Match logs.
    type: string
    default: future_use1,receive_time,serial_number,type,threat_content_type,future_use2,generated_time,source_user,virtual_system,machine_name,operating_system,source_address,hip,repeat_count,hip_type,future_use3,future_use4,sequence_number,action_flags,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,virtual_system_id,ipv6_source_address,host_id,user_device_serial_number,device_mac_address,high_resolution_timestamp
  ip-tags:
    name: IP-Tags log fields
    description: A comma-separated list of fields for IP-Tags logs.
    type: string
    default: future_use1_,receive_time,serial,type,threat_content_type,future_use2,generate_time,virtual_system,source_ip,tag_name_,event_id,repeat_count_,timeout,data_source_name,data_source_type,data_source_subtype,sequence_number,action_flags,dg_hierarchy_level_1_,dg_hierarchy_level_2,dg_hierarchy_level_3,dg_hierarchy_level_4,virtual_system_name,device_name,virtual_system_id,high_resolution_timestamp
  user-id:
    name: User-ID log fields
    description: A comma-separated list of fields for User-ID logs.
    type: string
    default: future_use1r,receive_time,serial_number,type,threat_content_type,future_use2,generated_time,virtual_system,source_ip,user,data_source_name,event_id,repeat_count,time_out_threshold,source_port,destination_port,data_source,data_source_type,sequence_number,action_flags,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,virtual_system_id,factor_type,factor_completion_time,factor_number,user_group_flags,user_by_source,tag_name,high_resolution_timestamp
  decryption:
    name: Decryption log fields
    description: A comma-separated list of fields for Decryption logs.
    type: string
    default: future_use1,receive_time,serial_number,type,threat_content_type,config_version,generate_time,source_address,destination_address,nat_source_ip,nat_destination_ip,rule,source_user,destination_user,application,virtual_system,source_zone,destination_zone,inbound_interface,outbound_interface,log_action,time_logged,session_id,repeat_count,source_port,destination_port,nat_source_port,nat_destination_port,flags,ip_protocol,action,tunnel,future_use2,future_use3,source_vm_uuid,destination_vm_uuid,uuid_for_rule,stage_for_client_to_firewall,stage_for_firewall_to_server,tls_version,key_exchange_algorithm,encryption_algorithm,hash_algorithm,policy_name,elliptic_curve,error_index,root_status,chain_status,proxy_type,certificate_serial_number,fingerprint,certificate_start_date,certificate_end_date,certificate_version,certificate_size,common_name_length,issuer_common_name_length,root_common_name_length,sni_length,certificate_flags,subject_common_name,issuer_subject_common_name,root_subject_common_name,server_name_indication,error,container_id,pod_namespace,pod_name,source_external_dynamic_list,destination_external_dynamic_list,source_dynamic_address_group,destination_dynamic_address_group,high_res_timestamp,source_device_category,source_device_profile,source_device_model,source_device_vendor,source_device_os_family,source_device_os_version,source_hostname,source_mac_address,destination_device_category,destination_device_profile,destination_device_model,destination_device_vendor,destination_device_os_family,destination_device_os_version,destination_hostname,destination_mac_address,sequence_number,action_flags,device_group_hierarchy_level_1,device_group_hierarchy_level_2,device_group_hierarchy_level_3,device_group_hierarchy_level_4,virtual_system_name,device_name,virtual_system_id,application_subcategory,application_category,application_technology,application_risk,application_characteristic,application_container,application_saas,application_sanctioned_state
  authentication:
    name: Authentication log fields
    description: A comma-separated list of fields for Authentication logs.
    type: string
    default: future_use1,receive_time,serial_number,type,threat_content_type,future_use2,generated_time,virtual_system,source_ip,user,normalize_user,object,authentication_policy,repeat_count,authentication_id,vendor,log_action,server_profile,description,client_type,event_type,factor_number,sequence_number,action_flags,device_group_hierarchy_1,device_group_hierarchy_2,device_group_hierarchy_3,device_group_hierarchy_4,virtual_system_name,device_name,virtual_system_id,authentication_protocol,uuid_for_rule,high_resolution_timestamp,source_device_category,source_device_profile,source_device_model,source_device_vendor,source_device_os_family,source_device_os_version,source_hostname,source_mac_address,region,future_use3,user_agent,session_id

pipelines:
  onboard-from-url:
    name: Onboard and parse Palo Alto logs
    description: |
      Onboards and parses Palo Alto Networks logs from the provided URL and
      publishes them to the topic `paloalto`.

      The package removes all reserved fields (starting with `future_use`) from
      the event and removes the Syslog framing.

       The package supports the following log types:
       - Traffic
       - GlobalProtect
       - Data Filtering
       - Correlation
       - Tunnel Inspection
       - Config
       - System
       - HIP Match
       - IP-Tags
       - User-ID
       - Decryption
       - Authentication

       All other log types get forwarded including their raw Syslog framing as
       `paloalto.unknown` events.
    definition: |
      from "{{ inputs.url }}" {
        read_syslog
      }
      if ",TRAFFIC," in content {
        content = content.parse_csv(header="{{ inputs.traffic }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.traffic"
      } else if ",GLOBALPROTECT," in content {
        content = content.parse_csv(header="{{ inputs.globalprotect }}")
        content.message = content.message.parse_kv(field_split="\\s*,\\s*", value_split="\\s*:\\s*")
        this = content.drop_matching("^future_use")
        @name = "paloalto.globalprotect"
      } else if ",THREAT," in content {
        content = content.parse_csv(header="{{ inputs.threat }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.threat"
      } else if ",URL-FILTERING," in content {
        content = content.parse_csv(header="{{ inputs.url-filtering }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.url-filtering"
      } else if ",DATA-FILTERING," in content {
        content = content.parse_csv(header="{{ inputs.data-filtering }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.data-filtering"
      } else if ",CORRELATION," in content {
        content = content.parse_csv(header="{{ inputs.correlation }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.correlation"
      } else if ",TUNNEL-INSPECTION," in content {
        content = content.parse_csv(header="{{ inputs.tunnel-inspection }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.tunnel-inspection"
      } else if ",CONFIG," in content {
        content = content.parse_csv(header="{{ inputs.config }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.config"
      } else if ",SYSTEM," in content {
        content = content.parse_csv(header="{{ inputs.system }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.system"
      } else if ",HIP-MATCH," in content {
        content = content.parse_csv(header="{{ inputs.hip-match }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.hip-match"
      } else if ",IP-TAGS," in content {
        content = content.parse_csv(header="{{ inputs.ip-tags }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.ip-tags"
      } else if ",USER-ID," in content {
        content = content.parse_csv(header="{{ inputs.user-id }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.user-id"
      } else if ",DECRYPTION," in content {
        content = content.parse_csv(header="{{ inputs.decryption }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.decryption"
      } else if ",AUTHENTICATION," in content {
        content = content.parse_csv(header="{{ inputs.authentication }}")
        this = content.drop_matching("^future_use")
        @name = "paloalto.authentication"
      } else {
        @name = "paloalto.unknown"
      }
      publish "paloalto"
  map-traffic-to-ocsf:
    name: Map Palo Alto Traffic to OCSF Network Activity
    description: |
      Maps Palo Alto Traffic events to OCSF Network Activity

      The pipeline subscribes to the `paloalto` topic, maps events and publishes
      to the `ocsf` topic.
    definition: |
      let $subtype_to_activity_id = {
        start: 1,
        end: 2,
        drop: 3,
        deny: 5,
      }
      let $action_to_action_id = {
        allow: 1,
        deny: 2,
        drop: 2,
        "drop ICMP": 2,
        "reset both": 0,
        "reset client": 0,
        "reset server": 0,
      }
      let $action_to_disposition_id = {
        allow: 1,
        deny: 2,
        drop: 6,
        "drop ICMP": 6,
        "reset both": 21,
        "reset client": 21,
        "reset server": 21,
      }

      subscribe "paloalto"
      where @name == "paloalto.traffic"
      this = { traffic: this }

      @name = "ocsf.network-activity"
      ocsf.category_name = "Network Activity"
      ocsf.category_uid = 4
      ocsf.metadata = {
        version: "1.6.0",
        profiles: ["host","security_control"],
        log_name: "Palo Alto Traffic Log",
        uid: move threat.sequence_number,
      }
      ocsf.class_name = "Network Activity"
      ocsf.class_uid = 4001
      ocsf.time = (move traffic.generated_time).parse_time("%Y/%m/%d %H:%M:%S")
      ocsf.start_time = (move traffic.start_time).parse_time("%Y/%m/%d %H:%M:%S")

      ocsf.activity_id = $subtype_to_activity_id[move traffic.threat_content_type]
      ocsf.action_id = $action_to_action_id[traffic.action]
      ocsf.disposition_id = $action_to_disposition_id[move traffic.action]

      ocsf.app_name = move traffic.application

      ocsf.device = {
        uid: move traffic.serial_number,
        name: move traffic.device_name,
      }

      ocsf.src_endpoint = {
        hostname: move traffic.source_hostname,
        ip: move traffic.source_address,
        port: move traffic.source_port,
        proxy_endpoint: {
          ip: move traffic.nat_source_ip,
          port: move traffic.nat_source_port,
        },
        mac: move traffic.source_mac_address,
        zone: move traffic.source_zone,
        interface_name: move traffic.inbound_interface,
        location: {
          country: move traffic.source_country,
        },
        owner: {
          name: move traffic.source_user,
        },
        hw_info: {
          vendor_name: move traffic.source_device_vendor,
          chassis: move traffic.source_device_category,
        },
        os: {
          version: move traffic.source_device_os_version,
          name: traffic.source_device_os_family,
          type: move traffic.source_device_os_family,
        },
      }

      ocsf.dst_endpoint = {
        hostname: move traffic.destination_hostname,
        ip: move traffic.destination_address,
        port: move traffic.destination_port,
        proxy_endpoint: {
          ip: move traffic.nat_destination_ip,
          port: move traffic.nat_destination_port,
        },
        mac: move traffic.destination_mac_address,
        zone: move traffic.destination_zone,
        interface_name: move traffic.outbound_interface,
        location: {
          country: move traffic.destination_country,
        },
        owner: {
          name: move traffic.destination_user,
        },
        hw_info: {
          vendor_name: move traffic.destination_device_vendor,
          chassis: move traffic.destination_device_category,
        },
        os: {
          version: move traffic.destination_device_os_version,
          name: traffic.destination_device_os_family,
          type: move traffic.destination_device_os_family,
        },
      }

      ocsf.connection_info = {
        protocol_name: move traffic.protocol,
        session: {
          uid: string(move traffic.session_id),
          expiration_reason: move traffic.session_end_reason,
          count: move threat.repeat_count,
        },
      }

      ocsf.traffic = {
        bytes_in: move traffic.bytes_received,
        bytes_out: move traffic.bytes_sent,
        packets_in: move traffic.packets_received,
        packets_out: move traffic.packets_sent,
        bytes: move traffic.bytes,
        packets: move traffic.packets,
      }

      ocsf.url = {
        categories: [move traffic.category]
      }

      ocsf.firewall_rule = {
        name: move traffic.rule_name
      }

      drop_null_fields traffic
      this = { ...ocsf, unmapped: move traffic }

      publish "ocsf"
  map-threat-to-ocsf:
    name: Map Palo Alto Threat to OCSF Network Activity
    description: |
      Maps Palo Alto Threat events to OCSF Network Activity

      The pipeline subscribes to the `paloalto` topic, maps events and publishes
      to the `ocsf` topic.
    definition: |
      let $severity_to_severity_id = {
        informational: 1,
        low: 2,
        medium: 3,
        high: 4,
        critial: 5,
      }

      let $action_to_disposition_id = {
        alert: 19,
        allow: 1,
        deny: 2,
        drop: 6,
        "reset-client": 21,
        "reset-server": 21,
        "reset-both": 21,
        "block-url": 2,
        "block-ip": 2,
        "random-drop": 6,
        "block-continue": 8,
        continue: 8,
        "block-override": 2,
        "override-lockout": 25,
        override: 8,
        block: 2,
      }

      subscribe "paloalto"
      where @name == "paloalto.threat"

      this = { threat: this }

      @name = "ocsf.network-activity"
      ocsf.category_name = "Network Activity"
      ocsf.category_uid = 4
      ocsf.metadata = {
        version: "1.6.0",
        profiles: ["host","security_control"],
        log_name: "Palo Alto Threat Log",
        uid: move threat.sequence_number,
      }
      ocsf.class_name = "Network Activity"
      ocsf.class_uid = 4001
      ocsf.time = (move threat.generated_time).parse_time("%Y/%m/%d %H:%M:%S")

      ocsf.severity_id = $severity_to_severity_id[move threat.severity]
      ocsf.disposition_id = $action_to_disposition_id[threat.action]? else 99
      ocsf.disposition = move threat.action if ocsf.disposition_id == 99 else null

      ocsf.app_name = move threat.application

      ocsf.device = {
        uid: move threat.serial_number,
        name: move threat.device_name,
      }

      ocsf.src_endpoint = {
        hostname: move threat.source_hostname,
        ip: move threat.source_address,
        port: move threat.source_port,
        proxy_endpoint: {
          ip: move threat.nat_source_ip,
          port: move threat.nat_source_port,
        },
        mac: move threat.source_mac_address,
        zone: move threat.source_zone,
        interface_name: move threat.inbound_interface,
        location: {
          country: move threat.source_location,
        },
        owner: {
          name: move threat.source_user,
        },
        hw_info: {
          vendor_name: move threat.source_device_vendor,
          chassis: move threat.source_device_category,
        },
        os: {
          version: move threat.source_device_os_version,
          name: threat.source_device_os_family,
          type: move threat.source_device_os_family,
        },
      }

      ocsf.dst_endpoint = {
        hostname: move threat.destination_hostname,
        ip: move threat.destination_address,
        port: move threat.destination_port,
        proxy_endpoint: {
          ip: move threat.nat_destination_ip,
          port: move threat.nat_destination_port,
        },
        mac: move threat.destination_mac_address,
        zone: move threat.destination_zone,
        interface_name: move threat.outbound_interface,
        location: {
          country: move threat.destination_country,
        },
        owner: {
          name: move threat.destination_user,
        },
        hw_info: {
          vendor_name: move threat.destination_device_vendor,
          chassis: move threat.destination_device_category,
        },
        os: {
          version: move threat.destination_device_os_version,
          name: threat.destination_device_os_family,
          type: move threat.destination_device_os_family,
        },
      }

      ocsf.connection_info = {
        protocol_name: move threat.ip_protocol,
        session: {
          uid: string(move threat.session_id),
          count: move threat.repeat_count,
        },
      }

      ocsf.policy = {
        name: move threat.threat_content_type,
        data: {
          threat_id: move threat.threat_id
        }
      }

      ocsf.url = {
        path: move threat.url_filename,
        categories: [move threat.category],
        resource_type: move threat.content_type
      }

      ocsf.firewall_rule = {
        name: move threat.rule_name
      }

      drop_null_fields traffic
      this = { ...ocsf, unmapped = move threat }
      publish "ocsf"
