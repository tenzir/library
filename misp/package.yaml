id: misp
name: MISP
author: Tenzir
author_icon: https://raw.githubusercontent.com/tenzir/library/main/.tenzir.svg
package_icon: |
  https://raw.githubusercontent.com/tenzir/library/main/misp/package.svg

description: |
  MISP (Malware Information Sharing Platform) is an open-source software
  solution for gathering, sharing, storing, and correlating Indicators of
  Compromise from cyberattacks, threat intelligence, and financial fraud.

  This package provides pipelines to fetch MISP events and normalize them
  to OCSF Inventory Info events.

categories:
- source

inputs:
  api-key-secret:
    name: API key secret name
    description: |
      Your MISP API key ID
    default: MISP_API_KEY

  refresh-interval:
    name: Context update interval
    description: |
      The duration between context updates that fetch attributes from the API.
    default: 1h

  base-url:
    name: Base API endpoint URL
    description: |
      The base URL of the MISP instance.
    default: https://misp.local

examples:
  - name: Fetches all MISP events
    description: |
      Fetches all MISP events and publishes them to the `misp` topic.
    definition: |
      let $base_url = "{{ inputs.base-url }}"
      let $url = $base_url + "/events/restSearch"
      from_http $url, headers={
        Authorization: secret("{{ inputs.api-key-secret }}"),
      }, body={
        to: now()
      } {
        read_json raw=true
      }
      unroll response
      this = response.Event
      // Fix up types because we pass raw=true to read_json above.
      timestamp = from_epoch(int(timestamp) * 1s)
      @name = "misp.event"
      publish "misp"
